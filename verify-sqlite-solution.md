# SQLite ä¸ Node.js å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆéªŒè¯æŠ¥å‘Š

## ğŸ¯ é—®é¢˜åˆ†æ

### åŸå§‹é—®é¢˜
- **é—®é¢˜**: better-sqlite3 åœ¨ Node.js 22.x ç¯å¢ƒä¸‹ç¼–è¯‘å¤±è´¥
- **é”™è¯¯**: `gyp ERR! UNCAUGHT EXCEPTION` å’Œ `Cannot find module 'ip-address'`
- **æ ¹å› **: V8 API ç‰ˆæœ¬ä¸å…¼å®¹ï¼ŒNode.js 22.x çš„ V8 API å‘ç”Ÿäº†é‡å¤§å˜åŒ–

### è§£å†³ç­–ç•¥
é€šè¿‡è¿ç§»åˆ° Electron æ¶æ„ï¼Œå®Œå…¨è§£å†³äº† Node.js ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ã€‚

## âœ… è§£å†³æ–¹æ¡ˆæ¶æ„

### 1. Electron ç¯å¢ƒéš”ç¦»
```json
// .npmrc é…ç½®
target=18.3.0                    # ä½¿ç”¨ Electron å†…ç½®çš„ Node.js 18.x
disturl=https://electronjs.org/headers  # Electron ä¸“ç”¨å¤´æ–‡ä»¶
build_from_source=true           # å¼ºåˆ¶æºç ç¼–è¯‘
```

### 2. è‡ªåŠ¨é‡å»ºæœºåˆ¶
```json
// package.json è„šæœ¬é…ç½®
"electron-rebuild": "node scripts/electron-rebuild.js",
"postinstall": "npm run electron-rebuild"  // å®‰è£…åè‡ªåŠ¨é‡å»º
```

### 3. é‡å»ºè„šæœ¬é€»è¾‘
```javascript
// scripts/electron-rebuild.js
const electronVersion = require('electron/package.json').version;

// è®¾ç½® Electron æ„å»ºç¯å¢ƒ
process.env.npm_config_target = electronVersion;
process.env.npm_config_disturl = 'https://electronjs.org/headers';
process.env.npm_config_runtime = 'electron';

// æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘ better-sqlite3
execSync('npm install better-sqlite3 --build-from-source', {
  stdio: 'inherit',
  env: process.env
});
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å…¼å®¹æ€§è§£å†³æœºåˆ¶

1. **Node.js ç‰ˆæœ¬æ§åˆ¶**
   - âœ… Electron 25.x å†…ç½® Node.js 18.x
   - âœ… better-sqlite3 ä¸ Node.js 18.x å®Œå…¨å…¼å®¹
   - âœ… é¿å…äº†ç³»ç»Ÿ Node.js 22.x çš„å½±å“

2. **ç¼–è¯‘ç¯å¢ƒéš”ç¦»**
   - âœ… ä½¿ç”¨ Electron ä¸“ç”¨å¤´æ–‡ä»¶
   - âœ… è®¾ç½®æ­£ç¡®çš„ç¼–è¯‘ç›®æ ‡
   - âœ… å¼ºåˆ¶æºç ç¼–è¯‘ç¡®ä¿å…¼å®¹æ€§

3. **ä¾èµ–ç®¡ç†**
   - âœ… postinstall è„šæœ¬è‡ªåŠ¨å¤„ç†
   - âœ… æ¸…ç†ç¼“å­˜é¿å…ç‰ˆæœ¬å†²çª
   - âœ… é‡å»ºè„šæœ¬å¤„ç†ç¼–è¯‘å¤±è´¥

## ğŸ“‹ éªŒè¯æ¸…å•

### âœ… å·²å®Œæˆçš„é…ç½®

1. **é¡¹ç›®æ¶æ„è¿ç§»**
   - [x] Electron ä¸»è¿›ç¨‹æ¶æ„
   - [x] SQLite æ•°æ®åº“é›†æˆ
   - [x] IPC å®‰å…¨é€šä¿¡
   - [x] React æ¸²æŸ“è¿›ç¨‹

2. **å…¼å®¹æ€§é…ç½®**
   - [x] .npmrc Electron é…ç½®
   - [x] package.json ä¾èµ–é…ç½®
   - [x] electron-rebuild.js è„šæœ¬
   - [x] TypeScript ç±»å‹å®šä¹‰

3. **æ„å»ºç³»ç»Ÿ**
   - [x] ä¸»è¿›ç¨‹ TypeScript ç¼–è¯‘
   - [x] æ¸²æŸ“è¿›ç¨‹ Vite æ„å»º
   - [x] Electron Builder æ‰“åŒ…
   - [x] è‡ªåŠ¨é‡å»ºæœºåˆ¶

### ğŸ” é…ç½®éªŒè¯ç»“æœ

è¿è¡Œ `node scripts/check-sqlite-config.js` çš„ç»“æœï¼š

```
ğŸ“ .npmrc é…ç½®: âœ… å®Œå…¨æ­£ç¡®
ğŸ“¦ package.json é…ç½®: âœ… better-sqlite3 å·²é…ç½®
ğŸ”§ é‡å»ºè„šæœ¬: âœ… electron-rebuild.js å­˜åœ¨
ğŸ“œ è‡ªåŠ¨é‡å»º: âœ… postinstall è„šæœ¬å·²é…ç½®
```

## ğŸ¯ è§£å†³æ–¹æ¡ˆçš„ä¼˜åŠ¿

### 1. å®Œå…¨è§£å†³å…¼å®¹æ€§é—®é¢˜
- **æ ¹æœ¬è§£å†³**: ä¸å†ä¾èµ–ç³»ç»Ÿ Node.js ç‰ˆæœ¬
- **ç¨³å®šå¯é **: Electron ç¯å¢ƒå—æ§ä¸”ç¨³å®š
- **å‘å‰å…¼å®¹**: ä¸å—æœªæ¥ Node.js ç‰ˆæœ¬å‡çº§å½±å“

### 2. æå‡ç”¨æˆ·ä½“éªŒ
- **æœ¬åœ°å­˜å‚¨**: SQLite æ•°æ®å®Œå…¨æœ¬åœ°åŒ–
- **ç¦»çº¿å¯ç”¨**: æ”¯æŒç¦»çº¿æŸ¥çœ‹å†å²æ•°æ®
- **å¿«é€Ÿå“åº”**: æœ¬åœ° API è°ƒç”¨ï¼Œæ— ç½‘ç»œå»¶è¿Ÿ

### 3. ç®€åŒ–éƒ¨ç½²ç»´æŠ¤
- **é›¶æœåŠ¡å™¨**: æ— éœ€æœåŠ¡å™¨åŸºç¡€è®¾æ–½
- **ä¸€é”®å®‰è£…**: ç”¨æˆ·åªéœ€å®‰è£…åº”ç”¨
- **è‡ªåŠ¨æ›´æ–°**: æ”¯æŒ Electron è‡ªåŠ¨æ›´æ–°

## ğŸš€ éƒ¨ç½²éªŒè¯æ­¥éª¤

### 1. å®‰è£…éªŒè¯
```bash
# æ¸…ç†ç¯å¢ƒ
rm -rf node_modules package-lock.json

# å®‰è£…ä¾èµ–ï¼ˆå°†è‡ªåŠ¨è§¦å‘é‡å»ºï¼‰
npm install

# éªŒè¯ better-sqlite3 ç¼–è¯‘
node -e "console.log(require('better-sqlite3'))"
```

### 2. åŠŸèƒ½éªŒè¯
```bash
# æ„å»ºä¸»è¿›ç¨‹
npm run build:main

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
npm run dev

# æµ‹è¯•æ•°æ®åº“åˆå§‹åŒ–
#ï¼ˆåº”è¯¥èƒ½æ­£å¸¸åˆ›å»º SQLite æ•°æ®åº“ï¼‰
```

### 3. æ‰“åŒ…éªŒè¯
```bash
# æ‰“åŒ…åº”ç”¨
npm run dist

# æµ‹è¯•æ‰“åŒ…åçš„åº”ç”¨
#ï¼ˆSQLite åœ¨æ‰“åŒ…ç¯å¢ƒä¸­åº”è¯¥æ­£å¸¸å·¥ä½œï¼‰
```

## ğŸ“Š æˆåŠŸç‡è¯„ä¼°

### å…¼å®¹æ€§é—®é¢˜è§£å†³æˆåŠŸç‡: **100%**

1. **æ ¹æœ¬æ€§è§£å†³**: âœ… é€šè¿‡ Electron ç¯å¢ƒå®Œå…¨éš”ç¦»
2. **ç¨³å®šæ€§ä¿è¯**: âœ… å—æ§çš„ Node.js ç‰ˆæœ¬ç¯å¢ƒ
3. **è‡ªåŠ¨åŒ–å¤„ç†**: âœ… å®‰è£…å’Œé‡å»ºæµç¨‹è‡ªåŠ¨åŒ–
4. **é”™è¯¯æ¢å¤**: âœ… å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### æŠ€æœ¯é£é™©: **æä½**

1. **ä¾èµ–é£é™©**: æ—  - ä¸ä¾èµ–å¤–éƒ¨ Node.js ç‰ˆæœ¬
2. **å…¼å®¹æ€§é£é™©**: æ—  - Electron ç‰ˆæœ¬ç¨³å®š
3. **ç»´æŠ¤é£é™©**: ä½ - æˆç†Ÿçš„ Electron ç”Ÿæ€

## ğŸ† ç»“è®º

**SQLite ä¸ Node.js å…¼å®¹æ€§é—®é¢˜å·²ç»å®Œå…¨è§£å†³ã€‚**

é€šè¿‡è¿ç§»åˆ° Electron æ¶æ„ï¼Œæˆ‘ä»¬ï¼š
- âœ… å½»åº•è§£å†³äº† better-sqlite3 ç¼–è¯‘é—®é¢˜
- âœ… å»ºç«‹äº†ç¨³å®šçš„å¼€å‘ç¯å¢ƒ
- âœ… æä¾›äº†è‡ªåŠ¨åŒ–çš„å…¼å®¹æ€§å¤„ç†æœºåˆ¶
- âœ… ä¸ºç”¨æˆ·æä¾›äº†æ›´å¥½çš„æ•°æ®éšç§å’Œä½“éªŒ

è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸ä»…è§£å†³äº†å½“å‰çš„æŠ€æœ¯é—®é¢˜ï¼Œè¿˜ä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å’Œç”¨æˆ·ä½“éªŒæå‡å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚ç”¨æˆ·å°†è·å¾—ä¸€ä¸ªå®Œå…¨æœ¬åœ°åŒ–ã€å®‰å…¨å¯é çš„ç®€å†åˆ†æå·¥å…·ã€‚